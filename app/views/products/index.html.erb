<div class="container mx-auto px-4 py-8">

  <div class="mb-10 fade-in">
    <h2 class="text-3xl font-bold text-gray-200 mb-4 text-center">–ì–∞—Ä—è—á—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó</h2>
    
    <div id="promo-slider" class="overflow-hidden relative rounded-xl shadow-2xl">
      <div class="flex transition-transform duration-500 ease-in-out" id="slider-container">
        <%# 1. –ë–∞–Ω–µ—Ä - –ü—Ä–∏–∫–ª–∞–¥ 1 %>
        <div class="w-full flex-shrink-0 h-48 md:h-64 bg-yellow-600 flex items-center justify-center text-gray-900 font-bold text-2xl" data-slide="0">
          –°–£–ü–ï–† –ó–ù–ò–ñ–ö–ê: –ù–∞–±—ñ—Ä "–ï–Ω–µ—Ä–≥—ñ—è" - 20%!
        </div>
        <%# 2. –ë–∞–Ω–µ—Ä - –ü—Ä–∏–∫–ª–∞–¥ 2 %>
        <div class="w-full flex-shrink-0 h-48 md:h-64 bg-green-700 flex items-center justify-center text-gray-100 font-bold text-2xl" data-slide="1">
          –ù–û–í–ò–ù–ö–ê: –û—Ä–≥–∞–Ω—ñ—á–Ω–∏–π —ñ–Ω–∂–∏—Ä –∑ –¢—É—Ä–µ—á—á–∏–Ω–∏
        </div>
        <%# 3. –ë–∞–Ω–µ—Ä - –ü—Ä–∏–∫–ª–∞–¥ 3 %>
        <div class="w-full flex-shrink-0 h-48 md:h-64 bg-red-700 flex items-center justify-center text-gray-100 font-bold text-2xl" data-slide="2">
          –î–û–°–¢–ê–í–ö–ê –ë–ï–ó–ö–û–®–¢–û–í–ù–û –≤—ñ–¥ 1000 ‚Ç¥
        </div>
      </div>

      <%# –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó) %>
      <button onclick="prevSlide()" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-gray-900 bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-80 transition z-10">
        &lt;
      </button>
      <button onclick="nextSlide()" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-gray-900 bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-80 transition z-10">
        &gt;
      </button>
    </div>
  </div>



  <div class="flex flex-col md:flex-row gap-8">
    
    <%# --- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê: –§–Ü–õ–¨–¢–†–ò —Ç–∞ –°–û–†–¢–£–í–ê–ù–ù–Ø (–®–∏—Ä–∏–Ω–∞ 1/4) --- %>
    <aside class="md:w-1/4 p-4 bg-gray-800 rounded-lg shadow-xl h-full sticky top-4 fade-in">
      <h3 class="text-2xl font-bold text-yellow-400 mb-6">–§—ñ–ª—å—Ç—Ä–∏</h3>
      
      <%= form_with url: products_path, method: :get, local: true, class: "space-y-6" do %>

        <%# 1. –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è %>
        <div class="border-b border-gray-700 pb-4">
          <label class="block text-lg font-semibold text-gray-200 mb-2">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞:</label>
          <%= select_tag :sort_by, options_for_select([
            ['–ó–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—é', 'popular'],
            ['–¶—ñ–Ω–∞: –≤—ñ–¥ –Ω–∏–∑—å–∫–æ—ó –¥–æ –≤–∏—Å–æ–∫–æ—ó', 'price_asc'],
            ['–¶—ñ–Ω–∞: –≤—ñ–¥ –≤–∏—Å–æ–∫–æ—ó –¥–æ –Ω–∏–∑—å–∫–æ—ó', 'price_desc'],
            ['–ù–æ–≤–∏–Ω–∫–∏', 'newest']
          ], params[:sort_by]), class: "w-full p-2 bg-gray-700 rounded text-gray-100 focus:ring-yellow-400 focus:border-yellow-400" %>
        </div>

        <%# 2. –§—ñ–ª—å—Ç—Ä –∑–∞ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏ %>
        <div class="border-b border-gray-700 pb-4">
          <label class="block text-lg font-semibold text-gray-200 mb-2">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</label>
          <div class="space-y-2 max-h-48 overflow-y-auto pr-2">
            <%# –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ —É –≤–∞—Å —î @categories, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ %>
            <% Category.all.each do |category| %>
              <div class="flex items-center">
                <%= check_box_tag "category_ids[]", category.id, params[:category_ids]&.include?(category.id.to_s), id: "category_#{category.id}", class: "h-4 w-4 text-yellow-500 rounded border-gray-600 focus:ring-yellow-500 bg-gray-700" %>
                <label for="category_<%= category.id %>" class="ml-2 text-gray-300 hover:text-yellow-400 cursor-pointer text-sm">
                  <%= category.name %>
                </label>
              </div>
            <% end %>
          </div>
        </div>

        <%# 3. –§—ñ–ª—å—Ç—Ä –∑–∞ –¶—ñ–Ω–æ—é (–¥—ñ–∞–ø–∞–∑–æ–Ω) %>
        <div class="pb-4">
          <label class="block text-lg font-semibold text-gray-200 mb-3">–î—ñ–∞–ø–∞–∑–æ–Ω —Ü—ñ–Ω (‚Ç¥)</label>
          <div class="flex space-x-2 items-center">
            
            <%= number_field_tag :min_price, params[:min_price], 
              placeholder: "–ú—ñ–Ω.", 
              class: "w-1/2 p-2 bg-gray-700 rounded text-gray-100 focus:ring-yellow-400 focus:border-yellow-400" %>
            
            <span class="text-gray-400">‚Äì</span>
            
            <%= number_field_tag :max_price, params[:max_price], 
              placeholder: "–ú–∞–∫—Å.", 
              class: "w-1/2 p-2 bg-gray-700 rounded text-gray-100 focus:ring-yellow-400 focus:border-yellow-400" %>
          </div>
        </div>
        
        <%# –ö–Ω–æ–ø–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ %>
        <%= submit_tag "–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏", class: "w-full bg-yellow-600 text-gray-900 font-bold py-2 rounded-lg hover:bg-yellow-500 transition duration-300 cursor-pointer" %>
        
        <%# –ö–Ω–æ–ø–∫–∞ —Å–∫–∏–¥–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ %>
        <%= link_to "–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏", products_path, class: "block text-center mt-2 text-gray-500 hover:text-yellow-400" %>
        
      <% end %>
    </aside>

    <%# --- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê: –ö–ê–¢–ê–õ–û–ì –¢–û–í–ê–†–Ü–í (–®–∏—Ä–∏–Ω–∞ 3/4) --- %>
<main class="md:w-3/4">
  <h1 class="text-3xl font-bold text-yellow-400 mb-8 fade-in">–ö–∞—Ç–∞–ª–æ–≥ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ñ–≤</h1>
  
  <% if @products.empty? %>
    <div class="text-center p-10 bg-gray-800 rounded-lg shadow-xl">
      <p class="text-gray-400 text-lg">–ù–∞ –∂–∞–ª—å, –∑–∞ –≤–∞—à–∏–º –∑–∞–ø–∏—Ç–æ–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É.</p>
      <%= link_to "–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏", products_path, class: "mt-4 inline-block text-yellow-400 hover:text-yellow-500" %>
    </div>
  <% else %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @products.each do |p| %>
        
        <%# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–∏—Ç–∫–∏: –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Ç—ñ–Ω—å —Ç–∞ hover-–∞–Ω—ñ–º–∞—Ü—ñ—é %>
        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg hover-scale fade-in border border-gray-700 hover:border-yellow-600 transition duration-300">
          
          <%# 1. –ó–û–ë–†–ê–ñ–ï–ù–ù–Ø: –û–ë–ï–†–ù–£–¢–ï –í –ü–û–°–ò–õ–ê–ù–ù–Ø (–ó–±—ñ–ª—å—à–µ–Ω–æ –≤–∏—Å–æ—Ç—É h-56) %>
          <%= link_to product_path(p) do %>
            <% if p.image_url.present? %>
              <img src="<%= p.image_url %>" class="w-full h-56 object-cover" alt="<%= p.name %>">
            <% end %>
          <% end %>
          
          <div class="p-4 flex flex-col">
            
            <%# –ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É (–û–∫—Ä–µ–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —â–æ–± –Ω–µ –±—É–ª–æ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å) %>
            <h5 class="text-xl font-semibold text-gray-100 mb-1 truncate">
              <%= link_to p.name, product_path(p), class: "hover:text-yellow-400 transition duration-300" %>
            </h5>
            
            <%# –ö–∞—Ç–µ–≥–æ—Ä—ñ—è %>
            <p class="text-sm text-gray-500 mb-2">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: <%= p.category.name if p.category %></p> 
            
            <%# –¶—ñ–Ω–∞ %>
            <p class="text-yellow-400 font-bold text-2xl mb-4">
              <%= number_to_currency(p.price, unit: "‚Ç¥ / –∑–∞ 100 –≥", format: "%n %u") %>
            </p>
            
            <%# üåü –°–ï–ö–¶–Ü–Ø –î–Ü–ô (–ö–Ω–æ–ø–∫–∏) üåü %>
            <div class="flex space-x-2 mt-auto">
              
              <%# –ö–ù–û–ü–ö–ê –ü–ï–†–ï–•–û–î–£ –ù–ê –°–¢–û–†–Ü–ù–ö–£ (–∑–∞–º—ñ—Å—Ç—å –¥–æ–¥–∞–≤–∞–Ω–Ω—è) %>
              <%= link_to "–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ", product_path(p),
                  class: "bg-yellow-600 text-gray-900 px-4 py-2 rounded-lg hover:bg-yellow-500 transition duration-300 text-sm font-medium" %>

              <%# –ö–ù–û–ü–ö–ê –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø (–¢—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω–∞) %>
              <% if current_user&.admin? %>
                <%= link_to "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏", edit_product_path(p), 
                            class: "bg-gray-700 text-gray-300 px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300 text-sm font-medium" %>
              <% end %>

            </div>
            
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</main>
  </div>
</div>


<script>
  let currentSlide = 0;
  const sliderContainer = document.getElementById('slider-container');
  const slides = sliderContainer ? sliderContainer.querySelectorAll('[data-slide]') : [];
  
  if (slides.length > 0) {
    const totalSlides = slides.length;

    function updateSlider() {
      if (sliderContainer) {
        sliderContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
      }
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateSlider();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateSlider();
    }
    
    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ (–¥–ª—è ERB-–∫–Ω–æ–ø–æ–∫)
    window.nextSlide = nextSlide;
    window.prevSlide = prevSlide;
    
    // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (–∑–∞ –±–∞–∂–∞–Ω–Ω—è–º)
    setInterval(nextSlide, 5000); // –ó–º—ñ–Ω—é–≤–∞—Ç–∏ —Å–ª–∞–π–¥ –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥
    
    // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É (–∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ flex –ø—Ä–∞—Ü—é—î)
    updateSlider();
  }
</script>