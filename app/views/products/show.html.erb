<div class="max-w-6xl mx-auto py-10 fade-in">
  
  <%# ---------------------- 1. –û–°–ù–û–í–ù–ê –°–ï–ö–¶–Ü–Ø –¢–û–í–ê–†–£ ---------------------- %>
  <div class="grid grid-cols-1 md:grid-cols-12 gap-10 bg-gray-800 p-8 rounded-2xl shadow-2xl">

    <%# --- –ö–û–õ–û–ù–ö–ê 1: –ó–û–ë–†–ê–ñ–ï–ù–ù–Ø (–®–∏—Ä–∏–Ω–∞ 5/12) --- %>
    <div class="md:col-span-5 relative">
      <% if @product.image_url.present? %>
        <img src="<%= @product.image_url %>" alt="<%= @product.name %>" 
             class="w-full h-96 object-cover rounded-xl shadow-lg border border-gray-700">
      <% else %>
        <div class="w-full h-96 flex items-center justify-center bg-gray-700 rounded-xl text-gray-400">
          –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ
        </div>
      <% end %>
    </div>

    <%# --- –ö–û–õ–û–ù–ö–ê 2: –î–ï–¢–ê–õ–Ü –¢–ê –î–Ü–á (–®–∏—Ä–∏–Ω–∞ 7/12) --- %>
    <div class="md:col-span-7 flex flex-col justify-between">
      
      <div>
        <%# –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è %>
        <h1 class="text-4xl font-extrabold text-yellow-400 mb-2"><%= @product.name %></h1>
        <p class="text-lg text-gray-400 mb-6">
          –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: 
          <% if @product.category.present? %>
            <%= link_to @product.category.name, category_path(@product.category), class: "text-gray-300 hover:text-yellow-400 font-medium" %>
          <% else %>
            –ù–µ –≤–∫–∞–∑–∞–Ω–æ
          <% end %>
        </p>
        
        <%# –¶—ñ–Ω–∞ —Ç–∞ –î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å %>
        <div class="border-t border-b border-gray-700 py-4 mb-6">
          <p class="text-5xl font-extrabold text-green-400 mb-2">
            <%= number_to_currency(@product.price, unit: "‚Ç¥ / –∑–∞ 100 –≥", format: "%n %u") %>
          </p>
          <p class="text-gray-500">
            –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ: <span class="text-green-500 font-semibold">–ì–æ—Ç–æ–≤–æ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è</span>
          </p>
        </div>
        
        <%# –ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Ñ–æ %>
        <ul class="space-y-2 text-gray-300 mb-8">
          <li>‚ú® –ù–∞—Ç—É—Ä–∞–ª—å–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç</li>
          <li>üì¶ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —â–æ–¥–Ω—è</li>
          <li>üöö –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –≤—ñ–¥ 1000 ‚Ç¥</li>
        </ul>

      </div>

      <%# üåü –§–û–†–ú–ê –î–õ–Ø –í–ò–ë–û–†–£ –í–ê–ì–ò üåü %>
      <%= form_with url: line_items_path, method: :post, local: true, class: "flex items-end space-x-4 mt-auto" do |form| %>
        
        <%= form.hidden_field :product_id, value: @product.id %>

        <%# –ü–æ–ª–µ –≤–∏–±–æ—Ä—É –∫—ñ–ª—å–∫–æ—Å—Ç—ñ (–≤–∞–≥–∏) %>
        <div class="flex flex-col">
          <%= form.label :quantity_grams, '–í–∞–≥–∞ (—É –≥—Ä–∞–º–∞—Ö)', class: "text-sm font-medium text-gray-400 mb-1" %>
          <%= form.number_field :quantity_grams, 
                                value: 100, # –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
                                min: 50,    # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–∞–≥–∞
                                step: 50,   # –ö—Ä–æ–∫ (–º–æ–∂–Ω–∞ –≤–∏–±—Ä–∞—Ç–∏ 50, 100, 150...)
                                required: true, 
                                class: "bg-gray-700 text-gray-100 p-3 rounded-xl border border-gray-600 focus:border-yellow-400 focus:ring focus:ring-yellow-400 focus:ring-opacity-50 w-32 shadow-inner" %>
        </div>

        <%# –ö–Ω–æ–ø–∫–∞ "–î–æ–¥–∞—Ç–∏" %>
        <%= form.submit "üõí –î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫", 
                        class: "bg-yellow-600 text-gray-900 px-8 py-3 rounded-xl hover:bg-yellow-500 transition duration-300 font-bold shadow-lg transform hover:scale-105 cursor-pointer" %>
      <% end %>
      
      <%# –ê–¥–º—ñ–Ω-–∫–Ω–æ–ø–∫–∞ %>
      <% if current_user&.admin? %>
        <%= link_to "‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏", edit_product_path(@product), 
            class: "bg-gray-700 text-gray-300 px-4 py-3 rounded-xl hover:bg-gray-600 transition duration-300 text-sm font-medium ml-4 mt-4" %>
      <% end %>

    </div>
  </div>

  <%# ---------------------- 2. –î–ï–¢–ê–õ–¨–ù–ò–ô –û–ü–ò–° ---------------------- %>
<div class="mt-10 bg-gray-800 p-8 rounded-2xl shadow-2xl fade-in">
  <h3 class="text-2xl font-bold text-yellow-400 mb-4 border-b border-gray-700 pb-2">–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å</h3>
  <div class="text-gray-300 leading-relaxed space-y-4">
    <%= simple_format(@product.description) %>
  </div>
</div>

<%# ---------------------- 3. –í–Ü–î–ì–£–ö–ò –¢–ê –†–ï–ô–¢–ò–ù–ì–ò ---------------------- %>
<div class="mt-10 bg-gray-800 p-8 rounded-2xl shadow-2xl fade-in">
  <div class="border-b border-gray-700 pb-4 mb-6 flex justify-between items-center">
    <h3 class="text-2xl font-bold text-yellow-400">–í—ñ–¥–≥—É–∫–∏ (<%= @product.reviews.count %>)</h3>
    
    <%# –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥—É %>
    <div class="text-xl font-bold text-gray-300 flex items-center">
      –†–µ–π—Ç–∏–Ω–≥: 
      <span class="text-yellow-400 ml-2">
        <% if @product.reviews.any? %>
          <%= '‚≠ê' * @product.average_rating.round %> (<%= @product.average_rating %> / 5)
        <% else %>
          (–ù–µ–º–∞—î —Ä–µ–π—Ç–∏–Ω–≥—É)
        <% end %>
      </span>
    </div>
  </div>
  
  <%# --- –§–û–†–ú–ê –î–û–î–ê–í–ê–ù–ù–Ø –í–Ü–î–ì–£–ö–£ --- %>
  <% if logged_in? %>
    <% if current_user.reviews.find_by(product_id: @product.id).nil? %>
      <div class="bg-gray-700 p-5 rounded-lg mb-8">
        <h4 class="text-xl font-semibold text-yellow-400 mb-4">–ù–∞–ø–∏—Å–∞—Ç–∏ –≤—ñ–¥–≥—É–∫:</h4>
        
        <%= form_with model: [@product, @product.reviews.build], local: true, class: "space-y-4" do |form| %>
          
          <%# –ü–æ–ª–µ –≤–∏–±–æ—Ä—É —Ä–µ–π—Ç–∏–Ω–≥—É (–∑—ñ—Ä–∫–∏) %>
          <div class="flex items-center space-x-2">
            <%= form.label :rating, '–í–∞—à–∞ –æ—Ü—ñ–Ω–∫–∞:', class: "text-gray-300 font-medium" %>
            <%= form.select :rating, options_for_select((1..5).to_a.reverse, 5), {}, 
                            { class: "bg-gray-800 border border-gray-600 rounded-lg p-2 text-gray-100" } %>
            <span class="text-xl text-yellow-400">‚≠ê</span>
          </div>
          
          <%# –ü–æ–ª–µ –æ–ø–∏—Å—É –≤—ñ–¥–≥—É–∫—É %>
          <%= form.text_area :body, rows: 4, placeholder: "–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º –≤—Ä–∞–∂–µ–Ω–Ω—è–º –ø—Ä–æ —Ç–æ–≤–∞—Ä...", 
                             class: "w-full bg-gray-800 border border-gray-600 rounded-lg p-3 text-gray-100 focus:border-yellow-400" %>
          
          <%= form.submit "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—ñ–¥–≥—É–∫", 
                          class: "bg-yellow-600 text-gray-900 px-6 py-2 rounded-lg hover:bg-yellow-500 transition duration-300 font-semibold cursor-pointer" %>
        <% end %>
      </div>
    <% else %>
      <div class="p-4 bg-yellow-900/50 rounded-lg text-yellow-100 mb-8">
        –í–∏ –≤–∂–µ –∑–∞–ª–∏—à–∏–ª–∏ –≤—ñ–¥–≥—É–∫ –ø—Ä–æ —Ü–µ–π —Ç–æ–≤–∞—Ä.
      </div>
    <% end %>
  <% else %>
    <div class="p-4 bg-gray-700 rounded-lg text-gray-400 mb-8">
      <%= link_to "–£–≤—ñ–π–¥—ñ—Ç—å", login_path, class: "text-yellow-400 hover:text-yellow-500 font-semibold" %> —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫.
    </div>
  <% end %>

  <%# --- –°–ü–ò–°–û–ö –Ü–°–ù–£–Æ–ß–ò–• –í–Ü–î–ì–£–ö–Ü–í --- %>
  <div class="space-y-6">
    <% @product.reviews.includes(:user).order(created_at: :desc).each do |review| %>
      <div class="bg-gray-700 p-4 rounded-lg shadow-md border-l-4 border-yellow-500">
        
        <div class="flex justify-between items-start mb-2">
          <%# –ê–≤—Ç–æ—Ä —Ç–∞ –î–∞—Ç–∞ %>
          <div class="text-gray-300">
            <span class="font-bold"><%= review.user.name %></span>
            <span class="text-sm text-gray-500 ml-2"><%= time_ago_in_words(review.created_at) %> —Ç–æ–º—É</span>
          </div>
          
          <%# –†–µ–π—Ç–∏–Ω–≥ %>
          <div class="text-xl text-yellow-400">
            <%= '‚≠ê' * review.rating %>
          </div>
        </div>
        
        <%# –¢—ñ–ª–æ –≤—ñ–¥–≥—É–∫—É %>
        <p class="text-gray-200 mb-3"><%= review.body %></p>
        
        <%# –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è (–¢—ñ–ª—å–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –∞–±–æ –∞–¥–º—ñ–Ω–∞) %>
        <% if current_user == review.user || current_user&.admin? %>
          <%= button_to "‚ùå –í–∏–¥–∞–ª–∏—Ç–∏", product_review_path(@product, review), method: :delete,
                        class: 'text-red-400 hover:text-red-500 text-sm transition mt-2',
                        data: { turbo_confirm: '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –≤—ñ–¥–≥—É–∫?' } %>
        <% end %>
      </div>
    <% end %>
    
    <% if @product.reviews.empty? %>
      <p class="text-gray-500 text-center py-4">–ë—É–¥—å—Ç–µ –ø–µ—Ä—à–∏–º, —Ö—Ç–æ –∑–∞–ª–∏—à–∏—Ç—å –≤—ñ–¥–≥—É–∫!</p>
    <% end %>
  </div>
</div>